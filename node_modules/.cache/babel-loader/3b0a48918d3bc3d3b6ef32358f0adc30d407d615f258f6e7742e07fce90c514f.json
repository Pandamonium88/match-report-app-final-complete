{"ast":null,"code":"import{useState}from\"react\";import{useTournament}from\"../context/TournamentContext\";import Papa from\"papaparse\";import{collection,addDoc,Timestamp}from\"firebase/firestore\";import{db}from\"../firebase\";import dayjs from\"dayjs\";import customParseFormat from\"dayjs/plugin/customParseFormat\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";dayjs.extend(customParseFormat);export default function UploadDraw(){const[file,setFile]=useState(null);const[status,setStatus]=useState(\"\");const{currentTournament}=useTournament();const handleUpload=async()=>{if(!file)return;setStatus(\"Parsing CSV...\");Papa.parse(file,{header:true,transformHeader:header=>header.toLowerCase().trim(),complete:async results=>{const data=results.data;let successCount=0;try{for(let row of data){if(!row.date||!row.time||!row.court||!row.division||!row.home||!row.away||!row.umpire)continue;const parsedDate=dayjs(row.date.trim(),[\"DD/MM/YYYY\",\"MM/DD/YYYY\"],true);console.log(\"Parsed date:\",row.date.trim(),\"=>\",parsedDate.format(\"YYYY-MM-DD\"));if(!parsedDate.isValid())continue;const match={date:Timestamp.fromDate(parsedDate.toDate()),time:row.time,court:row.court,division:row.division,home:row.home.trim(),away:row.away.trim(),umpire:row.umpire.trim()};if(!currentTournament){setStatus(\"❌ No tournament selected.\");return;}await addDoc(collection(db,`tournaments/${currentTournament.id}/matches`),match);successCount++;}setStatus(`✅ Uploaded ${successCount} matches.`);}catch(err){console.error(err);setStatus(\"❌ Error during upload.\");}},error:error=>{console.error(\"CSV Parse Error:\",error);setStatus(\"❌ Failed to parse CSV.\");}});};return/*#__PURE__*/_jsxs(\"div\",{className:\"p-4\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold mb-2\",children:\"Upload Match Draw\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\".csv\",onChange:e=>setFile(e.target.files[0]),className:\"mb-2\"}),/*#__PURE__*/_jsx(\"button\",{className:\"bg-blue-600 text-white px-4 py-2 rounded\",onClick:handleUpload,children:\"Upload\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-2 text-sm text-gray-700 dark:text-gray-200\",children:status})]});}","map":{"version":3,"names":["useState","useTournament","Papa","collection","addDoc","Timestamp","db","dayjs","customParseFormat","jsx","_jsx","jsxs","_jsxs","extend","UploadDraw","file","setFile","status","setStatus","currentTournament","handleUpload","parse","header","transformHeader","toLowerCase","trim","complete","results","data","successCount","row","date","time","court","division","home","away","umpire","parsedDate","console","log","format","isValid","match","fromDate","toDate","id","err","error","className","children","type","accept","onChange","e","target","files","onClick"],"sources":["/Users/andrewhall-villiers/Downloads/Match Report/match-report-app-final-complete/src/pages/UploadDraw.jsx"],"sourcesContent":["import { useState } from \"react\";\nimport { useTournament } from \"../context/TournamentContext\";\nimport Papa from \"papaparse\";\nimport { collection, addDoc, Timestamp } from \"firebase/firestore\";\nimport { db } from \"../firebase\";\nimport dayjs from \"dayjs\";\nimport customParseFormat from \"dayjs/plugin/customParseFormat\";\ndayjs.extend(customParseFormat);\n\nexport default function UploadDraw() {\n  const [file, setFile] = useState(null);\n  const [status, setStatus] = useState(\"\");\n  const { currentTournament } = useTournament();\n\n  const handleUpload = async () => {\n    if (!file) return;\n    setStatus(\"Parsing CSV...\");\n\n    Papa.parse(file, {\n      header: true,\n      transformHeader: (header) => header.toLowerCase().trim(),\n      complete: async (results) => {\n        const data = results.data;\n        let successCount = 0;\n        try {\n          for (let row of data) {\n            if (!row.date || !row.time || !row.court || !row.division || !row.home || !row.away || !row.umpire) continue;\n\n            const parsedDate = dayjs(row.date.trim(), [\"DD/MM/YYYY\", \"MM/DD/YYYY\"], true);\n            console.log(\"Parsed date:\", row.date.trim(), \"=>\", parsedDate.format(\"YYYY-MM-DD\"));\n            if (!parsedDate.isValid()) continue;\n\n            const match = {\n              date: Timestamp.fromDate(parsedDate.toDate()),\n              time: row.time,\n              court: row.court,\n              division: row.division,\n              home: row.home.trim(),\n              away: row.away.trim(),\n              umpire: row.umpire.trim(),\n            };\n\n            if (!currentTournament) {\n              setStatus(\"❌ No tournament selected.\");\n              return;\n            }\n\n            await addDoc(\n              collection(db, `tournaments/${currentTournament.id}/matches`),\n              match\n            );\n            successCount++;\n          }\n          setStatus(`✅ Uploaded ${successCount} matches.`);\n        } catch (err) {\n          console.error(err);\n          setStatus(\"❌ Error during upload.\");\n        }\n      },\n      error: (error) => {\n        console.error(\"CSV Parse Error:\", error);\n        setStatus(\"❌ Failed to parse CSV.\");\n      },\n    });\n  };\n\n  return (\n    <div className=\"p-4\">\n      <h2 className=\"text-xl font-bold mb-2\">Upload Match Draw</h2>\n      <input type=\"file\" accept=\".csv\" onChange={(e) => setFile(e.target.files[0])} className=\"mb-2\" />\n      <button className=\"bg-blue-600 text-white px-4 py-2 rounded\" onClick={handleUpload}>\n        Upload\n      </button>\n      <p className=\"mt-2 text-sm text-gray-700 dark:text-gray-200\">{status}</p>\n    </div>\n  );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}