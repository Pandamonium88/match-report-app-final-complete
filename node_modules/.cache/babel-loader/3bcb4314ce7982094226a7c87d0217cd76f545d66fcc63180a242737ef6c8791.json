{"ast":null,"code":"import{createContext,useContext,useEffect,useState,useCallback}from'react';import{auth,db}from'../firebase';import{onAuthStateChanged}from'firebase/auth';import{doc,getDoc,setDoc}from'firebase/firestore';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export const useAuth=()=>useContext(AuthContext);export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[role,setRole]=useState(null);const[loading,setLoading]=useState(true);const fetchUserRole=useCallback(async firebaseUser=>{try{var _snap$data;const ref=doc(db,'users',firebaseUser.uid);let snap=await getDoc(ref);if(!snap.exists()){await setDoc(ref,{email:firebaseUser.email,role:'unassigned',firstName:'',lastName:'',createdAt:new Date().toISOString()});snap=await getDoc(ref);// Refetch the doc after setting it\n}return((_snap$data=snap.data())===null||_snap$data===void 0?void 0:_snap$data.role)||'unassigned';}catch(error){console.error(\"Error fetching user role:\",error);return'unassigned';}},[]);useEffect(()=>{const unsubscribe=onAuthStateChanged(auth,async firebaseUser=>{setUser(firebaseUser);setRole(firebaseUser?await fetchUserRole(firebaseUser):null);setLoading(false);});return unsubscribe;},[fetchUserRole]);return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{user,role,loading},children:children});};","map":{"version":3,"names":["createContext","useContext","useEffect","useState","useCallback","auth","db","onAuthStateChanged","doc","getDoc","setDoc","jsx","_jsx","AuthContext","useAuth","AuthProvider","_ref","children","user","setUser","role","setRole","loading","setLoading","fetchUserRole","firebaseUser","_snap$data","ref","uid","snap","exists","email","firstName","lastName","createdAt","Date","toISOString","data","error","console","unsubscribe","Provider","value"],"sources":["/Users/andrewhall-villiers/Downloads/Match Report/match-report-app-final-complete/src/context/AuthContext.js"],"sourcesContent":["import { createContext, useContext, useEffect, useState, useCallback } from 'react';\nimport { auth, db } from '../firebase';\nimport { onAuthStateChanged } from 'firebase/auth';\nimport { doc, getDoc, setDoc } from 'firebase/firestore';\n\nconst AuthContext = createContext();\nexport const useAuth = () => useContext(AuthContext);\n\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const [role, setRole] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  const fetchUserRole = useCallback(async (firebaseUser) => {\n    try {\n      const ref = doc(db, 'users', firebaseUser.uid);\n      let snap = await getDoc(ref);\n  \n      if (!snap.exists()) {\n        await setDoc(ref, {\n          email: firebaseUser.email,\n          role: 'unassigned',\n          firstName: '',\n          lastName: '',\n          createdAt: new Date().toISOString()\n        });\n        snap = await getDoc(ref); // Refetch the doc after setting it\n      }\n  \n      return snap.data()?.role || 'unassigned';\n    } catch (error) {\n      console.error(\"Error fetching user role:\", error);\n      return 'unassigned';\n    }\n  }, []);\n\n  useEffect(() => {\n    const unsubscribe = onAuthStateChanged(auth, async (firebaseUser) => {\n      setUser(firebaseUser);\n      setRole(firebaseUser ? await fetchUserRole(firebaseUser) : null);\n      setLoading(false);\n    });\n    return unsubscribe;\n  }, [fetchUserRole]);\n\n  return (\n    <AuthContext.Provider value={{ user, role, loading }}>\n      {children}\n    </AuthContext.Provider>\n  );\n};"],"mappings":"AAAA,OAASA,aAAa,CAAEC,UAAU,CAAEC,SAAS,CAAEC,QAAQ,CAAEC,WAAW,KAAQ,OAAO,CACnF,OAASC,IAAI,CAAEC,EAAE,KAAQ,aAAa,CACtC,OAASC,kBAAkB,KAAQ,eAAe,CAClD,OAASC,GAAG,CAAEC,MAAM,CAAEC,MAAM,KAAQ,oBAAoB,CAAC,OAAAC,GAAA,IAAAC,IAAA,yBAEzD,KAAM,CAAAC,WAAW,cAAGb,aAAa,CAAC,CAAC,CACnC,MAAO,MAAM,CAAAc,OAAO,CAAGA,CAAA,GAAMb,UAAU,CAACY,WAAW,CAAC,CAEpD,MAAO,MAAM,CAAAE,YAAY,CAAGC,IAAA,EAAkB,IAAjB,CAAEC,QAAS,CAAC,CAAAD,IAAA,CACvC,KAAM,CAACE,IAAI,CAAEC,OAAO,CAAC,CAAGhB,QAAQ,CAAC,IAAI,CAAC,CACtC,KAAM,CAACiB,IAAI,CAAEC,OAAO,CAAC,CAAGlB,QAAQ,CAAC,IAAI,CAAC,CACtC,KAAM,CAACmB,OAAO,CAAEC,UAAU,CAAC,CAAGpB,QAAQ,CAAC,IAAI,CAAC,CAE5C,KAAM,CAAAqB,aAAa,CAAGpB,WAAW,CAAC,KAAO,CAAAqB,YAAY,EAAK,CACxD,GAAI,KAAAC,UAAA,CACF,KAAM,CAAAC,GAAG,CAAGnB,GAAG,CAACF,EAAE,CAAE,OAAO,CAAEmB,YAAY,CAACG,GAAG,CAAC,CAC9C,GAAI,CAAAC,IAAI,CAAG,KAAM,CAAApB,MAAM,CAACkB,GAAG,CAAC,CAE5B,GAAI,CAACE,IAAI,CAACC,MAAM,CAAC,CAAC,CAAE,CAClB,KAAM,CAAApB,MAAM,CAACiB,GAAG,CAAE,CAChBI,KAAK,CAAEN,YAAY,CAACM,KAAK,CACzBX,IAAI,CAAE,YAAY,CAClBY,SAAS,CAAE,EAAE,CACbC,QAAQ,CAAE,EAAE,CACZC,SAAS,CAAE,GAAI,CAAAC,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CACpC,CAAC,CAAC,CACFP,IAAI,CAAG,KAAM,CAAApB,MAAM,CAACkB,GAAG,CAAC,CAAE;AAC5B,CAEA,MAAO,EAAAD,UAAA,CAAAG,IAAI,CAACQ,IAAI,CAAC,CAAC,UAAAX,UAAA,iBAAXA,UAAA,CAAaN,IAAI,GAAI,YAAY,CAC1C,CAAE,MAAOkB,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,2BAA2B,CAAEA,KAAK,CAAC,CACjD,MAAO,YAAY,CACrB,CACF,CAAC,CAAE,EAAE,CAAC,CAENpC,SAAS,CAAC,IAAM,CACd,KAAM,CAAAsC,WAAW,CAAGjC,kBAAkB,CAACF,IAAI,CAAE,KAAO,CAAAoB,YAAY,EAAK,CACnEN,OAAO,CAACM,YAAY,CAAC,CACrBJ,OAAO,CAACI,YAAY,CAAG,KAAM,CAAAD,aAAa,CAACC,YAAY,CAAC,CAAG,IAAI,CAAC,CAChEF,UAAU,CAAC,KAAK,CAAC,CACnB,CAAC,CAAC,CACF,MAAO,CAAAiB,WAAW,CACpB,CAAC,CAAE,CAAChB,aAAa,CAAC,CAAC,CAEnB,mBACEZ,IAAA,CAACC,WAAW,CAAC4B,QAAQ,EAACC,KAAK,CAAE,CAAExB,IAAI,CAAEE,IAAI,CAAEE,OAAQ,CAAE,CAAAL,QAAA,CAClDA,QAAQ,CACW,CAAC,CAE3B,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}