{"ast":null,"code":"import{useEffect,useState}from\"react\";import{collection,getDocs,query,where}from\"firebase/firestore\";import{db}from\"../firebase\";import dayjs from\"dayjs\";import TournamentSelector from\"../components/TournamentSelector\";import{useAuth}from\"../context/AuthContext\";import{doc,updateDoc}from\"firebase/firestore\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function UmpireAppointments(){const[matches,setMatches]=useState([]);const[selectedDate,setSelectedDate]=useState(dayjs().format(\"YYYY-MM-DD\"));const[viewMode,setViewMode]=useState(\"day\");// or \"tournament\"\nconst[tournamentId,setTournamentId]=useState(null);const{role,user}=useAuth();const isAdmin=role===\"admin\";const[editingMatchId,setEditingMatchId]=useState(null);const[newUmpireName,setNewUmpireName]=useState(\"\");useEffect(()=>{if(!tournamentId)return;const fetchMatches=async()=>{const matchesRef=collection(db,`tournaments/${tournamentId}/matches`);const q=viewMode===\"day\"?query(matchesRef,where(\"date\",\"==\",selectedDate)):matchesRef;const snapshot=await getDocs(q);const data=snapshot.docs.map(doc=>({id:doc.id,...doc.data()}));setMatches(data);};fetchMatches();},[selectedDate,viewMode,tournamentId]);const times=[...new Set(matches.map(match=>match.time))].sort();const courts=[\"Court 1\",\"Court 2\",\"Court 3\",\"Court 4\"];const matchesByTimeAndCourt=times.map(time=>{const matchesAtTime=matches.filter(match=>match.time===time);const courtMap={};courts.forEach(court=>{courtMap[court]=matchesAtTime.find(match=>match.court===court);});return{time,courtMap};});const handleUmpireChange=async matchId=>{if(!newUmpireName||!tournamentId)return;const matchRef=doc(db,`tournaments/${tournamentId}/matches/${matchId}`);await updateDoc(matchRef,{umpireName:newUmpireName});setEditingMatchId(null);setNewUmpireName(\"\");setSelectedDate(prev=>prev);// Refresh\n};return/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 text-gray-900 dark:text-gray-100\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold mb-4\",children:\"Umpire Appointments\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap gap-4 mb-4 items-center\",children:[/*#__PURE__*/_jsx(TournamentSelector,{onSelect:setTournamentId}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:selectedDate,onChange:e=>setSelectedDate(e.target.value),className:\"border px-2 py-1 rounded\"}),/*#__PURE__*/_jsxs(\"select\",{value:viewMode,onChange:e=>setViewMode(e.target.value),className:\"border px-2 py-1 rounded\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"day\",children:\"Day View\"}),/*#__PURE__*/_jsx(\"option\",{value:\"tournament\",children:\"Tournament View\"})]})]}),matchesByTimeAndCourt.map(_ref=>{let{time,courtMap}=_ref;return/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-lg font-semibold mb-2\",children:time}),/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-4 gap-4\",children:courts.map(court=>{const match=courtMap[court];return/*#__PURE__*/_jsxs(\"div\",{className:\"border p-2 rounded shadow bg-white dark:bg-gray-700 text-sm\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"font-semibold\",children:court}),match?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"p\",{children:match.type}),/*#__PURE__*/_jsxs(\"p\",{children:[match.team1,\" vs \",match.team2]}),/*#__PURE__*/_jsxs(\"p\",{className:\"italic\",children:[\"Umpire:\",\" \",isAdmin&&editingMatchId===match.id?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"input\",{value:newUmpireName,onChange:e=>setNewUmpireName(e.target.value),className:\"text-black px-1 py-0.5 rounded\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleUmpireChange(match.id),className:\"ml-1 px-2 py-0.5 text-xs bg-blue-600 text-white rounded\",children:\"Save\"})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[match.umpireName,\" \",isAdmin&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setEditingMatchId(match.id);setNewUmpireName(match.umpireName||\"\");},className:\"ml-1 text-xs text-blue-400 underline\",children:\"Edit\"})]})]})]}):/*#__PURE__*/_jsx(\"p\",{className:\"italic text-gray-500\",children:\"No Match Scheduled\"})]},court);})})]},time);})]});}","map":{"version":3,"names":["useEffect","useState","collection","getDocs","query","where","db","dayjs","TournamentSelector","useAuth","doc","updateDoc","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","UmpireAppointments","matches","setMatches","selectedDate","setSelectedDate","format","viewMode","setViewMode","tournamentId","setTournamentId","role","user","isAdmin","editingMatchId","setEditingMatchId","newUmpireName","setNewUmpireName","fetchMatches","matchesRef","q","snapshot","data","docs","map","id","times","Set","match","time","sort","courts","matchesByTimeAndCourt","matchesAtTime","filter","courtMap","forEach","court","find","handleUmpireChange","matchId","matchRef","umpireName","prev","className","children","onSelect","type","value","onChange","e","target","_ref","team1","team2","onClick"],"sources":["/Users/andrewhall-villiers/Downloads/match-report-app-final-complete/src/pages/UmpireAppointments.jsx"],"sourcesContent":["import { useEffect, useState } from \"react\";\nimport { collection, getDocs, query, where } from \"firebase/firestore\";\nimport { db } from \"../firebase\";\nimport dayjs from \"dayjs\";\nimport TournamentSelector from \"../components/TournamentSelector\";\nimport { useAuth } from \"../context/AuthContext\";\nimport { doc, updateDoc } from \"firebase/firestore\";\n\nexport default function UmpireAppointments() {\n  const [matches, setMatches] = useState([]);\n  const [selectedDate, setSelectedDate] = useState(dayjs().format(\"YYYY-MM-DD\"));\n  const [viewMode, setViewMode] = useState(\"day\"); // or \"tournament\"\n  const [tournamentId, setTournamentId] = useState(null);\n\n  const { role, user } = useAuth();\n  const isAdmin = role === \"admin\";\n  const [editingMatchId, setEditingMatchId] = useState(null);\n  const [newUmpireName, setNewUmpireName] = useState(\"\");\n\n  useEffect(() => {\n    if (!tournamentId) return;\n    const fetchMatches = async () => {\n      const matchesRef = collection(db, `tournaments/${tournamentId}/matches`);\n      const q = viewMode === \"day\"\n        ? query(matchesRef, where(\"date\", \"==\", selectedDate))\n        : matchesRef;\n\n      const snapshot = await getDocs(q);\n      const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\n      setMatches(data);\n    };\n    fetchMatches();\n  }, [selectedDate, viewMode, tournamentId]);\n\n  const times = [...new Set(matches.map(match => match.time))].sort();\n  const courts = [\"Court 1\", \"Court 2\", \"Court 3\", \"Court 4\"];\n\n  const matchesByTimeAndCourt = times.map(time => {\n    const matchesAtTime = matches.filter(match => match.time === time);\n    const courtMap = {};\n    courts.forEach(court => {\n      courtMap[court] = matchesAtTime.find(match => match.court === court);\n    });\n    return { time, courtMap };\n  });\n\n  const handleUmpireChange = async (matchId) => {\n    if (!newUmpireName || !tournamentId) return;\n    const matchRef = doc(db, `tournaments/${tournamentId}/matches/${matchId}`);\n    await updateDoc(matchRef, { umpireName: newUmpireName });\n    setEditingMatchId(null);\n    setNewUmpireName(\"\");\n    setSelectedDate(prev => prev); // Refresh\n  };\n\n  return (\n    <div className=\"p-4 text-gray-900 dark:text-gray-100\">\n      <h1 className=\"text-2xl font-bold mb-4\">Umpire Appointments</h1>\n\n      <div className=\"flex flex-wrap gap-4 mb-4 items-center\">\n        <TournamentSelector onSelect={setTournamentId} />\n\n        <input\n          type=\"date\"\n          value={selectedDate}\n          onChange={(e) => setSelectedDate(e.target.value)}\n          className=\"border px-2 py-1 rounded\"\n        />\n\n        <select\n          value={viewMode}\n          onChange={(e) => setViewMode(e.target.value)}\n          className=\"border px-2 py-1 rounded\"\n        >\n          <option value=\"day\">Day View</option>\n          <option value=\"tournament\">Tournament View</option>\n        </select>\n      </div>\n\n      {matchesByTimeAndCourt.map(({ time, courtMap }) => (\n        <div key={time} className=\"mb-6\">\n          <h2 className=\"text-lg font-semibold mb-2\">{time}</h2>\n          <div className=\"grid grid-cols-4 gap-4\">\n            {courts.map(court => {\n              const match = courtMap[court];\n              return (\n                <div key={court} className=\"border p-2 rounded shadow bg-white dark:bg-gray-700 text-sm\">\n                  <p className=\"font-semibold\">{court}</p>\n                  {match ? (\n                    <>\n                      <p>{match.type}</p>\n                      <p>{match.team1} vs {match.team2}</p>\n                      <p className=\"italic\">\n                        Umpire:{\" \"}\n                        {isAdmin && editingMatchId === match.id ? (\n                          <>\n                            <input\n                              value={newUmpireName}\n                              onChange={(e) => setNewUmpireName(e.target.value)}\n                              className=\"text-black px-1 py-0.5 rounded\"\n                            />\n                            <button\n                              onClick={() => handleUmpireChange(match.id)}\n                              className=\"ml-1 px-2 py-0.5 text-xs bg-blue-600 text-white rounded\"\n                            >\n                              Save\n                            </button>\n                          </>\n                        ) : (\n                          <>\n                            {match.umpireName}{\" \"}\n                            {isAdmin && (\n                              <button\n                                onClick={() => {\n                                  setEditingMatchId(match.id);\n                                  setNewUmpireName(match.umpireName || \"\");\n                                }}\n                                className=\"ml-1 text-xs text-blue-400 underline\"\n                              >\n                                Edit\n                              </button>\n                            )}\n                          </>\n                        )}\n                      </p>\n                    </>\n                  ) : (\n                    <p className=\"italic text-gray-500\">No Match Scheduled</p>\n                  )}\n                </div>\n              );\n            })}\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}